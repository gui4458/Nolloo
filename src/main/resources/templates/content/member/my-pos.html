<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    layout:decorate="~{fragment/user_layout}">

<th:block layout:fragment="content_css">
    <!-- html ÌååÏùºÏù¥ Ïó¥Î¶¥Îïå Í∞ôÏù¥ Ïã§ÌñâÎêòÎäî css -->
    <link rel="stylesheet" href="/css/content/main.css">
</th:block>

<th:block layout:fragment="contentFragment">
    <!-- html ÏΩîÎìúÏûëÏÑ±-->
    <div class="mb-20">

        <div class="mx-auto max-w-7xl py-3 px-4 md:px-6 ">
            <div id="map" class="w-full min-h-[60dvh] shadow-xl shadow-slate-900/5 rounded-lg"></div>
        </div>
    
        <div class="mx-auto max-w-7xl py-3 px-4 md:px-6 ">
     
            <form action="/now" method="post" id="search-block"  class="grid grid-cols-3 gap-2 lg:grid-cols-5 lg:gap-4" >
                <select id="searchByCode" name="cateCode" class="block w-full rounded-md border-0 px-2 py-2 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6">
                    <option selected value="">Category</option>
                    <th:block th:each="cat : ${catList} ">
                        <option th:value="${cat.cateCode}">[[${cat.cateName}]]</option>
                    </th>
                </select>
    
                <select id="searchByRegion1" name="region1" class="block w-full rounded-md border-0 px-2 py-2 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6">
                    <option selected value="">ÏßÄÏó≠</option>
                    <option th:each="sidos : ${sidoList}" th:value="${sidos}" th:text="${sidos}"></option>
                </select>
                
                <select id="searchByRegion2" name="region2" class="block w-full rounded-md border-0 px-2 py-2 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6">
                    <option selected value="" readonly>ÏãúÍµ∞Íµ¨</option>
                </select>
    
                <script>
                    document.getElementById('searchByRegion1').addEventListener('change', function() {
                        var sido = this.value;
                        if (sido !== '') {
                            fetchSigungu(sido);
                        } else {
                            resetSigunguOptions();
                        }
                    });
                
                    function fetchSigungu(sido) {
                        fetch('/fetchSigungu?sido=' + sido)
                            .then(response => response.json())
                            .then(data => {
                                console.log(data);
                                updateSigunguOptions(data);
                            })
                            .catch(error => console.error('Error fetching sigungu:', error));
                    }
                
                    function updateSigunguOptions(sigunguList) {
                        var select = document.getElementById('searchByRegion2');
                        select.innerHTML = '<option selected value="">ÏãúÍµ∞Íµ¨Î•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</option>';
                        sigunguList.forEach(function(sigunguObj) {
                            var option = document.createElement('option');
                            option.value = sigunguObj.sigungu;
                            option.text = sigunguObj.sigungu;
                            select.appendChild(option);
                        });
                    }
                
                    function resetSigunguOptions() {
                        var select = document.getElementById('searchByRegion2');
                        select.innerHTML = '<option selected value="" readonly>ÏãúÍµ∞Íµ¨</option>';
                    }
                </script>
    
                <input id="searchByDate" type="date" name="searchDate" class="block w-full rounded-md border-0 px-2 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6" value="Date">
    
                <input type="button" class="w-full rounded-lg bg-red-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-red-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-red-600" value="Search" th:onclick="getMapData(document.querySelector('#searchByCode').value,document.querySelector('#searchByDate').value,document.querySelector('#searchByRegion1').value,document.querySelector('#searchByRegion2').value);">
            
            </form>
        </div>
    
        <div class="mx-auto max-w-7xl py-3 px-4 md:px-6 ">
            <div id="item-list"  class="grid grid-cols-1 lg:grid-cols-3 gap-4" >
    
                <div class="bg-white shadow-xl shadow-slate-900/5 rounded-lg" th:each="item : ${itemList}" >
                    <a th:href='@{/item/itemDetailForm(itemCode=${item.itemCode})}'>
                        <div class="flex flex-row p-3 lg:flex-col">
                            <div class="image-container w-24 h-24 lg:w-full lg:h-56 bg-cover bg-center rounded-full lg:rounded-lg" style="background-image: url('/upload/item/your_image.jpg');" th:style="'background-image: url(\'' + '/upload/item/' + ${item.imgList[0].attachedFileName} + '\');'">
                            </div>
                            <div class="ml-5 lg:ml-0 lg:mt-3">
                            <figcaption class="font-medium">
                                <div class="text-dark-600">
                                <span class="inline-flex items-center rounded-md bg-pink-50 px-2 py-1 text-xs font-medium text-pink-700 ring-1 ring-inset ring-pink-700/10">[[${item.cateName}]]</span><strong class="inline-flex text-xs py-1 pl-1">[[${item.itemPlace}]]</strong>
                                </div>
                                <div class="text-dark-600 font-bold mt-1">
                                [[${item.itemTitle}]]                    
                                </div>
                                <div class="text-slate-600 text-sm mt-1">
                                Description(Subtitle)
                                </div>
                                <div class="text-green-500 text-sm mt-1">
                                [[${item.itemStartDate}]]~[[${item.itemEndDate}]]
                                </div>
                            </figcaption>
                            </div>
                
                        </div>
                    </a>
                    <div class="w-8 h-8 ml-3">
                        <!-- <th:block sec:authorize="isAuthenticated()">
                        <div class="" th:onclick="wishDelete(this,[[${item.itemCode}]])"
                            th:if="${#lists.contains(wishCodeList,item.itemCode)}">
                            ‚ù§
                        </div>
                
                        <div class="" th:onclick="wishAdd(this,[[${item.itemCode}]])"
                            th:if="${!#lists.contains(wishCodeList,item.itemCode)}">
                            ü§ç
                        </div>
                        </th:block>
                        <th:block sec:authorize="isAnonymous()">
                            <div class="" onclick="gologin()">
                                ü§ç
                            </div>
                        </th:block> -->
                    </div>
                    <div id="distance" class="w-8 h-8 ml-3"> -km</div>
                </div> 
        
            </div>
        </div>
    </div>


</th:block>

<th:block layout:fragment="content_js">
    <!-- html ÌååÏùºÏù¥ Ïó¥Î¶¥Îïå Í∞ôÏù¥ Ïã§ÌñâÎêòÎäî js -->
    <!-- 3f269d19617ad795568529a85a77081a -->
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=3f269d19617ad795568529a85a77081a "></script>
    <script src="/js/my-pos.js"></script>
    <!-- <script src="/js/searchMore.js"></script> -->
</th:block>

</html>